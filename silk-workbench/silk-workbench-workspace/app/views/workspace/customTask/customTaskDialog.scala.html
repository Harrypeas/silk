@import org.silkframework.config.CustomTask
@import org.silkframework.runtime.plugin.PluginRegistry
@import org.silkframework.workspace.Project

@(project: Project, taskName: String, taskPlugin: Option[CustomTask], createDialog: Boolean)

@widgets.pluginDialog(
  project,
  name = taskName,
  plugins = PluginRegistry.availablePlugins[CustomTask],
  currentObj = taskPlugin,
  resources = project.resources.list,
  createDialog = createDialog) {

    <script type="text/javascript">
      function savePlugin(pluginId, name, parameters, callbacks) {
        // Build dataset xml
        var ctDoc = document.implementation.createDocument("", "CustomTask", null);
        var ct = ctDoc.documentElement;
        ct.setAttribute('id', name);
        ct.setAttribute('type', pluginId);
        for(var i in parameters) {
          var param = ctDoc.createElement('Param');
          param.setAttribute('name', parameters[i].name);
          param.appendChild(ctDoc.createCDATASection(parameters[i].value));
          ct.appendChild(param);
        }
        var oSerializer = new XMLSerializer();
        var xml = oSerializer.serializeToString(ctDoc);

        // Submit task
        @if(createDialog) {
          postTask('@config.baseUrl/workspace/projects/@project.name/customTasks/' + name, xml, callbacks);
        } else {
          putTask('@config.baseUrl/workspace/projects/@project.name/customTasks/' + name, xml, callbacks);
        }
      }
    </script>
}