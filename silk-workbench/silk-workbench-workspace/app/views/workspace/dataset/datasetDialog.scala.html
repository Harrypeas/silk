@import org.silkframework.dataset.{Dataset, DatasetSpec}
@import org.silkframework.workspace.Project

@(project: Project, datasetName: String, dataset: Option[DatasetSpec], title: String = "Edit Dataset", createDialog: Boolean = false)

@widgets.pluginDialog(
  project,
  name = datasetName,
  plugins = Dataset.availablePlugins,
  currentObj = dataset.map(_.plugin),
  resources = project.resources.listRecursive,
  title = title,
  submitLabel = "Save",
  secondaryLabel = "Autoconfigure",
  createDialog = createDialog) {

    <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
      <input class="mdl-textfield__input" type="text" id="dataset_uriProperty" name="dataset_uriProperty" value="@dataset.flatMap(_.uriProperty.map(_.uri)).getOrElse("")"/>
      <label class="mdl-textfield__label" for="dataset_uriProperty">URI property</label>
      <div class="mdl-tooltip mdl-tooltip--right" for="dataset_uriProperty">
        Setting this URI will generate an additional property for each entity.
        The additional property contains the URI of each entity.
      </div>
    </div>

    <script type="text/javascript">
      function savePlugin(pluginId, name, parameters, callbacks) {
        // Build dataset xml
        var xmlDoc = document.implementation.createDocument('', 'root', null);
        var xml = xmlDoc.createElement("Dataset");
        xml.setAttribute("id", name);
        xml.setAttribute("type", pluginId);
        xml.setAttribute("uriProperty", $('#dataset_uriProperty').val());
        for(var i in parameters) {
          var param = xmlDoc.createElement("Param");
          param.setAttribute('name', parameters[i].name);
          param.appendChild(xmlDoc.createCDATASection(parameters[i].value));
          xml.appendChild(param);
        }
        var xmlString = new XMLSerializer().serializeToString(xml);

        // Submit data source
        @if(createDialog) {
          postTask('@config.baseUrl/workspace/projects/@project.name/datasets', xmlString, callbacks);
        } else {
          putTask('@config.baseUrl/workspace/projects/@project.name/datasets/' + name, xmlString, callbacks);
        }
      }

      function autoConfigure(pluginId, name, parameters) {
        var queryString = $.param(parameters);
        var path = '@config.baseUrl/workspace/dialogs/editDatasetAutoConfigured/@project.name/' + name + '/' + pluginId + '?' + queryString;
        closeDialog();
        showDialog(path);
      }
    </script>
  }